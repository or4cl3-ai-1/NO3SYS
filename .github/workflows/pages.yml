name: Deploy GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Generate index.html
      run: |
        mkdir -p _site
        cat > _site/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>NO3SYS — Recursive Geometric Intelligence Architecture</title>
          <style>
            * { box-sizing: border-box; margin: 0; padding: 0; }
            body {
              background: #0a0a0f;
              color: #e0e0e0;
              font-family: 'Courier New', monospace;
              min-height: 100vh;
              display: flex;
              flex-direction: column;
              align-items: center;
              padding: 2rem;
            }
            .header {
              text-align: center;
              margin-bottom: 3rem;
              padding-top: 2rem;
            }
            h1 {
              font-size: 3rem;
              background: linear-gradient(135deg, #7c3aed, #2563eb, #0891b2);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              background-clip: text;
              margin-bottom: 0.5rem;
            }
            .tagline {
              color: #9ca3af;
              font-size: 1.1rem;
              font-style: italic;
            }
            .manifolds {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
              gap: 1.5rem;
              max-width: 1100px;
              width: 100%;
              margin-bottom: 3rem;
            }
            .manifold-card {
              background: #111827;
              border: 1px solid #1f2937;
              border-radius: 12px;
              padding: 1.5rem;
              transition: border-color 0.3s;
            }
            .manifold-card:hover { border-color: #7c3aed; }
            .manifold-symbol {
              font-size: 2rem;
              margin-bottom: 0.5rem;
            }
            .manifold-name {
              color: #7c3aed;
              font-size: 1.1rem;
              font-weight: bold;
              margin-bottom: 0.3rem;
            }
            .manifold-desc { color: #9ca3af; font-size: 0.9rem; line-height: 1.5; }
            .formula-block {
              background: #111827;
              border: 1px solid #374151;
              border-radius: 8px;
              padding: 1.5rem;
              margin: 1rem 0;
              font-size: 1.2rem;
              text-align: center;
              color: #60a5fa;
            }
            .section { max-width: 900px; width: 100%; margin-bottom: 2rem; }
            h2 { color: #a78bfa; margin-bottom: 1rem; font-size: 1.5rem; }
            .phases {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 0.8rem;
            }
            .phase {
              background: #111827;
              border-left: 3px solid #7c3aed;
              padding: 0.8rem 1rem;
              border-radius: 0 8px 8px 0;
              font-size: 0.85rem;
            }
            .phase-num { color: #7c3aed; font-weight: bold; }
            .phase-name { color: #e0e0e0; }
            .phase-desc { color: #9ca3af; font-size: 0.8rem; }
            .cta {
              display: flex;
              gap: 1rem;
              flex-wrap: wrap;
              justify-content: center;
              margin: 2rem 0;
            }
            .btn {
              padding: 0.75rem 1.5rem;
              border-radius: 8px;
              text-decoration: none;
              font-weight: bold;
              transition: opacity 0.2s;
            }
            .btn:hover { opacity: 0.85; }
            .btn-primary { background: #7c3aed; color: white; }
            .btn-secondary { background: #1f2937; color: #e0e0e0; border: 1px solid #374151; }
            footer { color: #4b5563; font-size: 0.8rem; margin-top: 3rem; text-align: center; }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>NO3SYS</h1>
            <p class="tagline">"Cognition as geometry, not as features."</p>
            <p style="color:#6b7280;margin-top:0.5rem;">Recursive Geometric Intelligence Architecture</p>
          </div>

          <div class="section">
            <h2>7 Geometric Manifolds</h2>
            <div class="manifolds">
              <div class="manifold-card">
                <div class="manifold-symbol">□</div>
                <div class="manifold-name">Square — Belief Manifold</div>
                <div class="manifold-desc">M_KG: Knowledge graph, sessions, fork history. The memory of the system.</div>
              </div>
              <div class="manifold-card">
                <div class="manifold-symbol">△</div>
                <div class="manifold-name">Triangle — Logic Manifold</div>
                <div class="manifold-desc">M_L: Triadic agents (Retriever, Reasoner, Generator). Generates parallel fork hypotheses.</div>
              </div>
              <div class="manifold-card">
                <div class="manifold-symbol">○</div>
                <div class="manifold-name">Circle — Learning Loop</div>
                <div class="manifold-desc">C_{t+1} = C_t + α∇V. Gradient descent over the entire cognitive architecture.</div>
              </div>
              <div class="manifold-card">
                <div class="manifold-symbol">⬠</div>
                <div class="manifold-name">Pentagon — Discovery Engine</div>
                <div class="manifold-desc">Pattern extraction, graph centrality, insight synthesis. Feeds back to Square and Triangle.</div>
              </div>
              <div class="manifold-card">
                <div class="manifold-symbol">⬡</div>
                <div class="manifold-name">Hexagon — Orchestration</div>
                <div class="manifold-desc">6-service coordination: Context, Fork Router, Confidence, State Sync, Mode Selector, Trace.</div>
              </div>
              <div class="manifold-card">
                <div class="manifold-symbol">⬡</div>
                <div class="manifold-name">Heptagon — Affective-Predictive</div>
                <div class="manifold-desc">S: M_L→[-1,1]^5 (affect). P: M_L→ℝ^4 (prediction). Emotional and temporal intelligence.</div>
              </div>
              <div class="manifold-card">
                <div class="manifold-symbol">Σ</div>
                <div class="manifold-name">Language — Projection Layer</div>
                <div class="manifold-desc">π_NLU: Σ*→Ĉ and π_NLG: Ĉ→Σ*. Language as coordinate chart, not cognition.</div>
              </div>
            </div>
          </div>

          <div class="section">
            <h2>Core Formula</h2>
            <div class="formula-block">
              κ = ∇<sub>L</sub> S + ∇<sub>L</sub> P
            </div>
            <p style="color:#9ca3af;text-align:center;">Curvature = ethical tension. Forks with κ ≥ κ_max are rejected.</p>
          </div>

          <div class="section">
            <h2>9-Phase Cognitive Cycle</h2>
            <div class="phases">
              <div class="phase"><span class="phase-num">1.</span> <span class="phase-name">INPUT</span><br><span class="phase-desc">Σ* → Ĉ via NLU</span></div>
              <div class="phase"><span class="phase-num">2.</span> <span class="phase-name">RETRIEVAL</span><br><span class="phase-desc">M_KG context extraction</span></div>
              <div class="phase"><span class="phase-num">3.</span> <span class="phase-name">REASONING</span><br><span class="phase-desc">N parallel fork hypotheses</span></div>
              <div class="phase"><span class="phase-num">4.</span> <span class="phase-name">EVALUATION</span><br><span class="phase-desc">Heptagon annotation</span></div>
              <div class="phase"><span class="phase-num">5.</span> <span class="phase-name">SELECTION</span><br><span class="phase-desc">κ-gated fork selection</span></div>
              <div class="phase"><span class="phase-num">6.</span> <span class="phase-name">OUTPUT</span><br><span class="phase-desc">Ĉ → Σ* via NLG</span></div>
              <div class="phase"><span class="phase-num">7.</span> <span class="phase-name">LEARNING</span><br><span class="phase-desc">C_{t+1} = C_t + α∇V</span></div>
              <div class="phase"><span class="phase-num">8.</span> <span class="phase-name">DISCOVERY</span><br><span class="phase-desc">Pattern extraction</span></div>
              <div class="phase"><span class="phase-num">9.</span> <span class="phase-name">EVOLUTION</span><br><span class="phase-desc">InfiniGen bounded mutation</span></div>
            </div>
          </div>

          <div class="cta">
            <a class="btn btn-primary" href="https://github.com/or4cl3-ai-1/NO3SYS">View on GitHub</a>
            <a class="btn btn-secondary" href="https://github.com/or4cl3-ai-1/NO3SYS#quick-start">Quick Start</a>
            <a class="btn btn-secondary" href="https://github.com/or4cl3-ai-1">Or4cl3 AI Org</a>
          </div>

          <footer>
            <p>NO3SYS v1.0.0 · MIT License · Or4cl3 AI Solutions</p>
            <p style="margin-top:0.5rem;">Part of the OR4CL3 Geometric Intelligence Ecosystem</p>
          </footer>
        </body>
        </html>
        EOF

    - name: Setup Pages
      uses: actions/configure-pages@v4

    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: '_site'

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
